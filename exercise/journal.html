<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Tim Condit" />
  <meta name="dcterms.date" content="2018-09-08" />
  <title>Technical Exercise Journal</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Technical Exercise Journal</h1>
<p class="author">Tim Condit</p>
<p class="date">September 8, 2018</p>
</header>
<p>A clean slate on which to drop everything I think, imagine, ask about, do or whatever. If I do it right, by Friday 9/14 I’ll have a record of my rapid evolution that will feed into a presentation.</p>
<h2 id="sat">20180908 Sat</h2>
<ul>
<li><p>Tina’s birthday! &lt;3</p></li>
<li><strong>CURRENTLY</strong> at my desk in Kirkland at 2:20pm. I’ve read the Word doc a few times, and have decided to start by creating some AMIs as many times as it takes to feel comfortable with the process. Do at least four times, then assess. Expect to write and throw away some code.</li>
<li><p><strong>CONSIDERING</strong> adding IAM role and users for the hiring team: Robert, Alex, Christine, Chris</p></li>
<li>Looks like I’m also creating a mini-vocabulary
<ul>
<li><strong>CURRENTLY</strong> what I’m doing, thinking, etc. right now</li>
<li><strong>CONSIDERING</strong> what I’m <em>thinking</em> about doing, etc.</li>
<li><strong>TOOLS</strong> things I may want to mention</li>
</ul></li>
<li>[ ] <strong>TODO</strong> packer AMI #1</li>
<li>[ ] <strong>TODO</strong> packer AMI #2</li>
<li>[ ] <strong>TODO</strong> packer AMI #3</li>
<li><p>[ ] <strong>TODO</strong> packer AMI #4</p></li>
<li><strong>CONSIDERING</strong></li>
<li><strong>CURRENTLY</strong></li>
<li><strong>TOOLS</strong></li>
<li><strong>TODO</strong> (shell alias _ + todo)</li>
<li><strong>SHORTCUT</strong></li>
<li><p><strong>I-DONE-THAT</strong> (shell alias _ + idone)</p></li>
<li><p>[ ] <strong>TODO</strong> store configuration code (Packer, TF, Ansible) together or separate? Name conventions?</p></li>
<li><strong>TOOLS</strong> direnv
<ul>
<li>I just love this thing, but haven’t done enough with it yet ; in particular, I want direnv to come to me, not the other way around</li>
<li><a href="https://direnv.net/">direnv</a></li>
</ul></li>
<li><strong>TOOLS</strong> awless
<ul>
<li><a href="https://github.com/wallix/awless">awless</a></li>
</ul></li>
<li><strong>TOOLS</strong> jsonlint
<ul>
<li>kind of forgot about this one, TBH</li>
</ul></li>
<li><strong>TOOLS</strong> tmux
<ul>
<li>noob: still feels awkward ; need to unlock the power</li>
</ul></li>
<li><strong>TERMS</strong> <builder> a component of Packer that is responsible for creating a machine and turning that machine into an image.
<ul>
<li><a href="https://www.packer.io/intro/getting-started/build-image.html">Build an Image</a></li>
</ul></li>
<li><p><font color="blue">this would not pass an MD linter, but it’s fine for what I need right now</font></p></li>
<li><strong>TOOLS</strong> ag</li>
<li><strong>TOOLS</strong> pandoc
<ul>
<li>you may be reading its output right now</li>
<li><p>see <code>README.md</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">pandoc</span> -s journal.md -o journal.html --standalone</a></code></pre></div></li>
</ul></li>
<li>gotta stop screwing around and get to work
<ul>
<li>nice to get this started though</li>
<li>also makes me wish <code>Quiver</code> had a terminal (maybe ncurses) mode</li>
</ul></li>
</ul>
<h3 id="a.-infrastructure-setup-create-a-base-linux-ami-using-packer">1a. Infrastructure Setup: Create a base Linux AMI using Packer</h3>
<ul>
<li>oh man, the <code>Packer</code> docs include an <code>IAM permissions policy</code> for creating images!
<ul>
<li><a href="https://www.packer.io/docs/builders/amazon.html#iam-task-or-instance-role">IAM Task or Instance Role</a></li>
</ul></li>
<li><p>hmmm …</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/technical-exercise</span> ☕️  packer build example.json</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="ex">amazon-ebs</span> output will be in this color.</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Prevalidating AMI Name: packer-example 1536446645</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    <span class="ex">amazon-ebs</span>: Found Image ID: ami-04169656fea786776</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating temporary keypair: packer_5b9450b5-c47d-01f2-057e-ea26b23a3abe</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating temporary security group for this instance: packer_5b9450b8-a777-891f-4c08-acbb84856fe3</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Authorizing access to port 22 from 0.0.0.0/0 in the temporary security group...</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Launching a source AWS instance...</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Adding tags to source instance</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">    <span class="ex">amazon-ebs</span>: Adding tag: <span class="st">&quot;Name&quot;</span>: <span class="st">&quot;Packer Builder&quot;</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Error launching source instance: Blocked: This account is currently blocked and not recognized as a valid account. Please contact aws-verification@amazon.com if you have questions.</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>:     status code: 400, request id: 52d84bdd-b048-49f1-b3e0-b6b7cf53385a</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: No volumes to clean up, skipping</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Deleting temporary security group...</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Deleting temporary keypair...</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="ex">Build</span> <span class="st">&#39;amazon-ebs&#39;</span> errored: Error launching source instance: Blocked: This account is currently blocked and not recognized as a valid account. Please contact aws-verification@amazon.com if you have questions.</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">    <span class="ex">status</span> code: 400, request id: 52d84bdd-b048-49f1-b3e0-b6b7cf53385a</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">==<span class="op">&gt;</span> <span class="ex">Some</span> builds didn<span class="dt">\&#39;</span>t complete successfully and had errors:</a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="ex">--</span><span class="op">&gt;</span> amazon-ebs: Error launching source instance: Blocked: This account is currently blocked and not recognized as a valid account. Please contact aws-verification@amazon.com if you have questions.</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">    <span class="ex">status</span> code: 400, request id: 52d84bdd-b048-49f1-b3e0-b6b7cf53385a</a>
<a class="sourceLine" id="cb2-23" data-line-number="23"></a>
<a class="sourceLine" id="cb2-24" data-line-number="24">==<span class="op">&gt;</span> <span class="ex">Builds</span> finished but no artifacts were created.</a></code></pre></div></li>
<li><p>and yet:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/technical-exercise</span> ☕️  aws s3 ls</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="ex">2007-10-21</span> 22:19:49 7a539b26dafcc37a4b376ce712198e7-default</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="ex">2015-04-08</span> 19:26:58 cf-templates-1ksa07uibso6e-us-east-1</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="ex">2015-04-08</span> 19:47:56 cf-templates-1ksa07uibso6e-us-west-2</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="ex">2017-01-06</span> 08:01:40 export-from-cof-macbookpro</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="ex">2017-10-02</span> 20:06:11 manual-uploads-00</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="ex">2018-06-06</span> 22:12:01 nsc-export-20180606</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="ex">2015-07-11</span> 20:47:19 tc-awscodepipeline-demobucket-20150711</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="ex">2017-05-07</span> 13:53:36 tc-personal-vault</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="ex">2011-04-12</span> 04:59:37 timc-home-C-Source</a></code></pre></div></li>
<li>I don’t believe this is an issue with my credentials. My credit card was replaced recently, but it wasn’t up to date. However, (and I’ve never seen this before), I wasn’t able to enter new card details. Whatever, I’ll use my “temporary” Nortek account.
<ul>
<li>account ID <code>499932752752</code> ; IAM user <code>timcondit</code>; region <code>us-west-2</code></li>
<li>new PEM file <code>liatrio-tech-exercise.pem</code></li>
</ul></li>
<li>[x] <strong>TODO</strong> update <code>./.envrc</code>
<ul>
<li>specifically, swap out <code>tcondit@gmail.com</code> creds for <code>tim.condit@nortek.com</code></li>
</ul></li>
<li><p>[x] <strong>TODO</strong> command for querying <code>AMIs</code> owned by me</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/technical-exercise</span> ☕️  aws ec2 describe-images --region=us-east-1 --executable-users=self</a></code></pre></div></li>
<li><p>[ ] <strong>TODO</strong> <code>jq</code> command to filter the output! (Someday I’ll “get” <code>jq</code>. Today isn’t that day.)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/technical-exercise</span> ☕️  packer build example.json</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="ex">amazon-ebs</span> output will be in this color.</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Prevalidating AMI Name: packer-example 1536448495</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    <span class="ex">amazon-ebs</span>: Found Image ID: ami-04169656fea786776</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating temporary keypair: packer_5b9457ef-dcf1-5147-78fe-59883a889e14</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating temporary security group for this instance: packer_5b9457f1-f6a3-dd33-1be9-1a82d71ca150</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Authorizing access to port 22 from 0.0.0.0/0 in the temporary security group...</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Launching a source AWS instance...</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Adding tags to source instance</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    <span class="ex">amazon-ebs</span>: Adding tag: <span class="st">&quot;Name&quot;</span>: <span class="st">&quot;Packer Builder&quot;</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    <span class="ex">amazon-ebs</span>: Instance ID: i-05529e68f720f28d6</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for instance (i-05529e68f720f28d6) <span class="ex">to</span> become ready...</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for SSH to become available...</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Connected to SSH!</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Stopping the source instance...</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">    <span class="ex">amazon-ebs</span>: Stopping instance, attempt 1</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for the instance to stop...</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating the AMI: packer-example 1536448495</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">    <span class="ex">amazon-ebs</span>: AMI: ami-0bc879ad121ec0902</a>
<a class="sourceLine" id="cb5-21" data-line-number="21">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for AMI to become ready...</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Terminating the source AWS instance...</a>
<a class="sourceLine" id="cb5-23" data-line-number="23">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Cleaning up any extra volumes...</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: No volumes to clean up, skipping</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Deleting temporary security group...</a>
<a class="sourceLine" id="cb5-26" data-line-number="26">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Deleting temporary keypair...</a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="ex">Build</span> <span class="st">&#39;amazon-ebs&#39;</span> finished.</a>
<a class="sourceLine" id="cb5-28" data-line-number="28"></a>
<a class="sourceLine" id="cb5-29" data-line-number="29">==<span class="op">&gt;</span> <span class="ex">Builds</span> finished. The artifacts of successful builds are:</a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="ex">--</span><span class="op">&gt;</span> amazon-ebs: AMIs were created:</a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="ex">us-east-1</span>: ami-0bc879ad121ec0902</a></code></pre></div></li>
<li>dependencies:
<ul>
<li>AWS secret key &amp; access key</li>
<li>packer</li>
<li>AWS account</li>
<li>able to run a simple command in the terminal</li>
</ul></li>
<li>[ ] <strong>TODO</strong> need to protect the secret key &amp; access key ; others are fine ; moving on</li>
<li>There’s no need for a Git repo</li>
<li><p>I’m calling this step done for now</p></li>
</ul>
<h3 id="infrastructure-setup-create-ansible-scripts-to-spin-up-the-server-created-in-step-1a.">Infrastructure Setup: Create Ansible scripts to spin up the server created in step 1a.</h3>
<ul>
<li><strong>SHORTCUT</strong> manually create an EC2 instance from the packer-example AMI
<ul>
<li>focus on Ansible/CM ; come back to TF after</li>
</ul></li>
<li>key I created earlier (<code>liatrio-tech-exercise.pem</code>) has two flaws
<ul>
<li>the name is too generic and it’s in the “wrong” region</li>
<li>I created it in <code>us-west-2</code>, but am now working in <code>us-east-1</code> per <code>example.json</code> (oops)</li>
<li>[ ] <strong>TODO</strong> delete the key in <code>us-west-2</code>, recreate in <code>us-east-1</code> with a proper name
<ul>
<li>call it <code>liatrio-us-east-1.pem</code></li>
</ul></li>
</ul></li>
<li><strong>I-DONE-THAT</strong> added <code>./config</code> with per-host configuration
<ul>
<li><p>not worth going any further making it more general</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># platform: /etc/etc/lsb-release -&gt; Ubuntu 16.04.5 LTS</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="ex">Host</span> Jenkins-Nexus</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="ex">Hostname</span> 34.227.32.75</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="ex">User</span> ubuntu</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="ex">IdentityFile</span> /Users/tim.condit/PhilipJFry/cloud-storage/Dropbox/jobs/20180819-Liatrio/technical-exercise/liatrio-us-east-1.pem</a></code></pre></div></li>
</ul></li>
<li><strong>CONSIDER</strong> where/when to add the Jenkins and Nexus packages?
<ul>
<li>if it were just “yum install jenkins nexus” I’d do it via Packer ; and maybe it is that simple ; but I’ve seen with Mongo, for example, where it’s anything but simple
<ul>
<li>that’s a nearly pathological case though, and maybe not something I want to condone, let alone enable</li>
<li>trapped on an old version ; data corruption ; gross</li>
</ul></li>
<li>a more positively focused reason to use Ansible for the package installs
<ul>
<li>use Packer to include general purpose stuff that should always be present, like package updates, monitoring software, maybe an admin account, etc. (stem cells)</li>
<li>use Ansible to configure packages that are needed for specific purposes (differentiated cells)</li>
</ul></li>
</ul></li>
</ul>
<h4 id="aside-aka-waste-of-time-1start">Aside AKA Waste of Time (1/start)</h4>
<ul>
<li>[ ] <strong>TODO</strong> make a <code>CentOS</code> packer template
<ul>
<li>stick with <code>us-east-1</code> though</li>
</ul></li>
<li>playing with the instructions (from Gruntwork!) on how to find the product ID and image info via the AWS Marketplace
<ul>
<li><a href="https://blog.gruntwork.io/locating-aws-ami-owner-id-and-image-name-for-packer-builds-7616fe46b49a">Locating AWS Marketplace AMI Owner Id and Image Name for Packer Builds</a></li>
</ul></li>
<li>It’s led to this <code>RHEL</code> image so far (getting warmer)
<ul>
<li><a href="https://aws.amazon.com/marketplace/server/procurement?productId=1dbbb9c1-b882-4575-947e-23660fc5991b" class="uri">https://aws.amazon.com/marketplace/server/procurement?productId=1dbbb9c1-b882-4575-947e-23660fc5991b</a></li>
<li>productId=<code>1dbbb9c1-b882-4575-947e-23660fc5991b</code></li>
</ul></li>
<li>the instructions in the Gruntwork blog didn’t work (at least as written), but this <code>AWS cli</code> query from RedHat works great
<ul>
<li><p><a href="https://access.redhat.com/solutions/15356">How to list the latest available RHEL images on Amazon Web Services (AWS)</a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/technical-exercise</span> ☕️  aws ec2 describe-images --owners 309956199498 --query <span class="st">&#39;Images[*].[CreationDate,Name,ImageId]&#39;</span> --filters <span class="st">&quot;Name=name,Values=RHEL-7.?*GA*&quot;</span> --region us-east-1 --output table <span class="kw">|</span> <span class="fu">sort</span> -r</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">|</span>  <span class="ex">2018-03-23T20</span>:42:08.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.5_HVM_GA-20180322-x86_64-1-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-6871a115</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">|</span>  <span class="ex">2017-08-08T15</span>:37:31.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.4_HVM_GA-20170808-x86_64-2-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-c998b6b2</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="kw">|</span>  <span class="ex">2017-07-24T15</span>:44:39.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.4_HVM_GA-20170724-x86_64-1-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-cdc999b6</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">|</span>  <span class="ex">2016-10-26T22</span>:32:29.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.3_HVM_GA-20161026-x86_64-1-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-b63769a1</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="kw">|</span>  <span class="ex">2015-11-12T21</span>:06:58.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.2_HVM_GA-20151112-x86_64-1-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-2051294a</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="kw">|</span>  <span class="ex">2015-02-25T20</span>:24:23.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.1_HVM_GA-20150225-x86_64-1-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-12663b7a</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="kw">|</span>  <span class="ex">2015-02-09T22</span>:54:40.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.0_HVM_GA-20150209-x86_64-1-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-60a1e808</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw">|</span>  <span class="ex">2014-10-17T20</span>:29:24.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.0_HVM_GA-20141017-x86_64-1-Hourly2-GP2</span>  <span class="kw">|</span>  <span class="ex">ami-a8d369c0</span> <span class="kw">|</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="kw">|</span>  <span class="ex">2014-05-28T19</span>:17:11.000Z <span class="kw">|</span>  <span class="ex">RHEL-7.0_GA_HVM-x86_64-3-Hourly2</span>               <span class="kw">|</span>  <span class="ex">ami-785bae10</span> <span class="kw">|</span></a></code></pre></div></li>
</ul></li>
<li>this also works for <code>CentOS</code>, but the output is lengthy (not shown)
<ul>
<li><p>takes <em>forever</em> to run ; not worth it</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/technical-exercise</span> ☕️ aws ec2 describe-images \</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">                                  --owners <span class="st">&#39;aws-marketplace&#39;</span> \</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                                  --filters <span class="st">&#39;Name=product-code,Values=aw0evgkw8e5c1q413zgy5pjce&#39;</span> \</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">                                  --output <span class="st">&#39;text&#39;</span></a></code></pre></div></li>
</ul></li>
<li>I’ve wasted too much time on this, with no results to show for it ; sticking with Ubuntu and moving on
<ul>
<li>recent familiarity was the reason for trying to make a CentOS or RedHat AMI ; I hope I don’t get bit in the ass using Ubuntu</li>
</ul></li>
</ul>
<h4 id="aside-aka-waste-of-time-1end">Aside AKA Waste of Time (1/end)</h4>
<ul>
<li>installed <code>ansible</code> on the temp EC2 (<code>Jenkins-Nexus</code>) for the sole purpose of copying the <code>ansible.cfg</code> and <code>hosts</code> files from <code>/etc/ansible</code> ; I’ll edit them here</li>
</ul>
<p>This was momentarily confusing</p>
<pre><code>```bash
~/P/c/D/j/2/t/ansible (*) ☕️  ansible -m ping all
 [WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match &#39;all&#39;
```</code></pre>
<p>Verbose?</p>
<pre><code>```bash
~/P/c/D/j/2/t/ansible (*) ☕️  ansible -v -m ping all
Using /Users/tim.condit/.config/ansible/ansible.cfg as config file
 [WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match &#39;all&#39;
```</code></pre>
<p>What do <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_configuration.html">the docs</a> say?</p>
<p>Also, where’d this come from? I must have added it long ago (dirty machine). Might be time to spin up a control machine at AWS too.</p>
<pre><code>```bash
~/P/c/D/j/2/t/ansible (*) ☕️  echo $ANSIBLE_CONFIG
/Users/tim.condit/.config/ansible/ansible.cfg
```</code></pre>
<p>Taken together, these three are too much. I’m gonna spin up a control machine on AWS.</p>
<ol type="1">
<li><div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/t/ansible</span> (*) ☕️  <span class="ex">ansible</span> -v -m ping all</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="ex">Using</span> /Users/tim.condit/PhilipJFry/cloud-storage/Dropbox/jobs/20180819-Liatrio/technical-exercise/ansible/ansible.cfg as config file</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="ex">34.227.32.75</span> <span class="kw">|</span> <span class="ex">UNREACHABLE</span>! =<span class="op">&gt;</span> {</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="st">&quot;changed&quot;</span>: <span class="fu">false</span>,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    <span class="st">&quot;msg&quot;</span>: <span class="st">&quot;Failed to connect to the host via ssh: tcondit@34.227.32.75: Permission denied (publickey).\r\n&quot;</span>,</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">    <span class="st">&quot;unreachable&quot;</span>: <span class="fu">true</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">}</a></code></pre></div></li>
<li><div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/t/ansible</span> (*) ☕️  <span class="fu">ssh</span> Jenkins-Nexus</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ex">ssh</span>: Could not resolve hostname jenkins-nexus: nodename nor servname provided, or not known</a></code></pre></div></li>
<li><div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/t/ansible</span> (*) ☕️  <span class="fu">ssh</span> -F ../config Jenkins-Nexus</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ex">Welcome</span> to Ubuntu 16.04.5 LTS (GNU/Linux 4.4.0-1065-aws x86_64)</a></code></pre></div></li>
</ol>
<ul>
<li>[ ] <strong>TODO</strong> get updates into <code>Packer</code> image (how?)
<ul>
<li>prioritize this for later</li>
</ul></li>
<li><p>updated <code>example.json</code> to <code>Bionic Beaver 18.04.1 LTS</code> ; let’s see how/if it works</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="ex">~/P/c/D/j/2/technical-exercise</span> ☕️  packer build example.json</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="ex">amazon-ebs</span> output will be in this color.</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Prevalidating AMI Name: packer-example 1536464481</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="ex">amazon-ebs</span>: Found Image ID: ami-07917569e2c4a2b6a</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating temporary keypair: packer_5b949661-7f5e-4eb9-17de-4a2cb5bab5cb</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating temporary security group for this instance: packer_5b949664-b361-e162-8fbe-70700f92a9be</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Authorizing access to port 22 from 0.0.0.0/0 in the temporary security group...</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Launching a source AWS instance...</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Adding tags to source instance</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">    <span class="ex">amazon-ebs</span>: Adding tag: <span class="st">&quot;Name&quot;</span>: <span class="st">&quot;Packer Builder&quot;</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">    <span class="ex">amazon-ebs</span>: Instance ID: i-0de16739ed057d4bb</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for instance (i-0de16739ed057d4bb) <span class="ex">to</span> become ready...</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for SSH to become available...</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Connected to SSH!</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Stopping the source instance...</a>
<a class="sourceLine" id="cb15-17" data-line-number="17">    <span class="ex">amazon-ebs</span>: Stopping instance, attempt 1</a>
<a class="sourceLine" id="cb15-18" data-line-number="18">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for the instance to stop...</a>
<a class="sourceLine" id="cb15-19" data-line-number="19">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Creating the AMI: packer-example 1536464481</a>
<a class="sourceLine" id="cb15-20" data-line-number="20">    <span class="ex">amazon-ebs</span>: AMI: ami-027a933122e083b25</a>
<a class="sourceLine" id="cb15-21" data-line-number="21">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Waiting for AMI to become ready...</a>
<a class="sourceLine" id="cb15-22" data-line-number="22">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Terminating the source AWS instance...</a>
<a class="sourceLine" id="cb15-23" data-line-number="23">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Cleaning up any extra volumes...</a>
<a class="sourceLine" id="cb15-24" data-line-number="24">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: No volumes to clean up, skipping</a>
<a class="sourceLine" id="cb15-25" data-line-number="25">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Deleting temporary security group...</a>
<a class="sourceLine" id="cb15-26" data-line-number="26">==<span class="op">&gt;</span> <span class="ex">amazon-ebs</span>: Deleting temporary keypair...</a>
<a class="sourceLine" id="cb15-27" data-line-number="27"><span class="ex">Build</span> <span class="st">&#39;amazon-ebs&#39;</span> finished.</a>
<a class="sourceLine" id="cb15-28" data-line-number="28"></a>
<a class="sourceLine" id="cb15-29" data-line-number="29">==<span class="op">&gt;</span> <span class="ex">Builds</span> finished. The artifacts of successful builds are:</a>
<a class="sourceLine" id="cb15-30" data-line-number="30"><span class="ex">--</span><span class="op">&gt;</span> amazon-ebs: AMIs were created:</a>
<a class="sourceLine" id="cb15-31" data-line-number="31"><span class="ex">us-east-1</span>: ami-027a933122e083b25</a></code></pre></div></li>
<li><strong>I-DONE-THAT</strong> created new AMI (18.04) ; created new 18.04 instances <code>jenkins-nexus</code> and <code>admin</code></li>
<li><strong>I-DONE-THAT</strong> terminated 16.04 instances <code>jenkins-nexus</code> and <code>admin</code> ; deleted 16.04 AMIs (two) ; deleted 16.04 snapshots (two)</li>
<li><p><strong>I-DONE-THAT</strong> updated <code>config</code> and verified SSH access</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ex">ubuntu@ip-172-31-29-171</span>:~$ sudo apt-get install git ansible</a></code></pre></div></li>
<li>[ ] <strong>TODO</strong> amend user name for these commits
<ul>
<li>commit 69141d997f80829ee0d5589160450259c9cacf14</li>
<li>commit b581237a7289210bb752cad2e68409d3ef39142c</li>
<li>commit 7a9f6939842c3ebf08f84bd941a217bce689e10f</li>
<li>commit 06e2cfbcceec5840b382081d1b3ec2488c9903c5</li>
<li>or don’t bother</li>
</ul></li>
<li><p>(from Ubuntu/admin)</p></li>
<li>created branch <code>develop</code></li>
<li>installed on both machines
<ul>
<li>ansible</li>
<li>awscli</li>
<li>direnv</li>
<li>git</li>
<li>neovim</li>
</ul></li>
<li>[ ] <strong>TODO</strong> I really should just suck it up and create a playbook for this</li>
<li><p>[ ] <strong>TODO</strong> get my nvim config on the <code>admin</code> instance</p></li>
<li><p>thinking more about <code>Packer</code> and <code>Ansible</code>, I may want to “bake in” <code>Ansible</code> and dependencies into the images</p></li>
<li>[ ] <strong>TODO</strong> need to think about bootstrapping <code>ansible-galaxy</code> roles onto <code>admin</code>
<ul>
<li>what are the configuration steps? It’s been a long time</li>
<li>can I “bootstrap” the install via a playbook? Never tried it, but maybe.</li>
</ul></li>
<li>this was new to me ; I like it
<ul>
<li><a href="https://zaiste.net/automatically_install_ansible_galaxy_roles_with_requirements_yml/">Automatically install Ansible Galaxy roles with requirements.yml</a></li>
</ul></li>
<li><p>trouble</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="ex">ubuntu@ip-172-31-29-171</span>:~/interview-liatrio-2018/technical-exercise/ansible$ ansible-playbook playbook.yml --limit=admin</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="ex">172.31.18.219</span> <span class="kw">|</span> <span class="ex">SUCCESS</span> =<span class="op">&gt;</span> {</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">&quot;ansible_facts&quot;</span>: <span class="kw">{</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    <span class="st">&quot;ansible_all_ipv4_addresses&quot;</span>:<span class="bu"> [</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">        <span class="st">&quot;172.31.18.219&quot;</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">    ],</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">...</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">172.31.18.219 | FAILED<span class="ot">!</span> =<span class="ot">&gt;</span> {</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="st">&quot;cache_update_time&quot;</span>: 1536476283,</a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="st">&quot;cache_updated&quot;</span>: false,</a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="st">&quot;changed&quot;</span>: false,</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="st">&quot;msg&quot;</span>: <span class="st">&quot;&#39;/usr/bin/apt-get -y -o </span><span class="dt">\&quot;</span><span class="st">Dpkg::Options::=--force-confdef</span><span class="dt">\&quot;</span><span class="st"> -o </span><span class="dt">\&quot;</span><span class="st">Dpkg::Options::=--force-confold</span><span class="dt">\&quot;</span><span class="st">     install &#39;jenkins&#39;&#39; failed: E: Sub-process /usr/bin/dpkg returned an error code (1)\n&quot;</span>,</a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="st">&quot;rc&quot;</span>: 100,</a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="st">&quot;stderr&quot;</span>: <span class="st">&quot;E: Sub-process /usr/bin/dpkg returned an error code (1)\n&quot;</span>,</a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="st">&quot;stderr_lines&quot;</span>: [</a>
<a class="sourceLine" id="cb17-16" data-line-number="16">    <span class="st">&quot;E: Sub-process /usr/bin/dpkg returned an error code (1)&quot;</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17">],</a>
<a class="sourceLine" id="cb17-18" data-line-number="18"><span class="st">&quot;stdout&quot;</span>: <span class="st">&quot;Reading package lists...\nBuilding dependency tree...\nReading state information...\njenkins is already the newest version (2.141).\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n1 not fully installed or removed.\nAfter this operation, 0 B of additional disk space will be used.\nSetting up jenkins (2.141) ...\r\nJob for jenkins.service failed because the control process exited with error code.\r\nSee </span><span class="dt">\&quot;</span><span class="st">systemctl status jenkins.service</span><span class="dt">\&quot;</span><span class="st"> and </span><span class="dt">\&quot;</span><span class="st">journalctl -xe</span><span class="dt">\&quot;</span><span class="st"> for details.\r\ninvoke-rc.d: initscript jenkins, action </span><span class="dt">\&quot;</span><span class="st">start</span><span class="dt">\&quot;</span><span class="st"> failed.\r\n\u001b[0;1;31m*\u001b[0m jenkins.service - LSB: Start Jenkins at boot time\r\n   Loaded: loaded (/etc/init.d/jenkins; generated)\r\n   Active: \u001b[0;1;31mfailed\u001b[0m (Result: exit-code) since Sun 2018-09-09 07:02:35 UTC; 6ms ago\r\n     Docs: man:systemd-sysv-generator(8)\r\n  Process: 27630 ExecStart=/etc/init.d/jenkins start \u001b[0;1;31m(code=exited, status=1/FAILURE)\u001b[0m\r\n\r\nSep 09 07:02:35 ip-172-31-18-219 systemd[1]: Starting LSB: Start Jenkins at boot time...\r\nSep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: Found an incorrect Java version\r\nSep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: Java version found:\r\nSep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: openjdk version </span><span class="dt">\&quot;</span><span class="st">10.0.2</span><span class="dt">\&quot;</span><span class="st"> 2018-07-17\r\nSep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: OpenJDK Runtime Environment (build 10.0.2+13-Ubuntu-1ubuntu0.18.04.1)\r\nSep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: OpenJDK 64-Bit Server VM (build 10.0.2+13-Ubuntu-1ubuntu0.18.04.1, mixed mode)\r\nSep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: Aborting\r\nSep 09 07:02:35 ip-172-31-18-219 systemd[1]: \u001b[0;1;39m\u001b[0;1;31m\u001b[0;1;39mjenkins.service: Control process exited, code=exited status=1\u001b[0m\r\nSep 09 07:02:35 ip-172-31-18-219 systemd[1]: \u001b[0;1;39m\u001b[0;1;31m\u001b[0;1;39mjenkins.service: Failed with result &#39;exit-code&#39;.\u001b[0m\r\nSep 09 07:02:35 ip-172-31-18-219 systemd[1]: \u001b[0;1;31m\u001b[0;1;39m\u001b[0;1;31mFailed to start LSB: Start Jenkins at boot time.\u001b[0m\r\ndpkg: error processing package jenkins (--configure):\r\n installed jenkins package post-installation script subprocess returned error exit status 1\r\nErrors were encountered while processing:\r\n jenkins\r\n&quot;</span>,</a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="st">&quot;stdout_lines&quot;</span>: [</a>
<a class="sourceLine" id="cb17-20" data-line-number="20">    <span class="st">&quot;Reading package lists...&quot;</span>,</a>
<a class="sourceLine" id="cb17-21" data-line-number="21">    <span class="st">&quot;Building dependency tree...&quot;</span>,</a>
<a class="sourceLine" id="cb17-22" data-line-number="22">    <span class="st">&quot;Reading state information...&quot;</span>,</a>
<a class="sourceLine" id="cb17-23" data-line-number="23">    <span class="st">&quot;jenkins is already the newest version (2.141).&quot;</span>,</a>
<a class="sourceLine" id="cb17-24" data-line-number="24">    <span class="st">&quot;0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.&quot;</span>,</a>
<a class="sourceLine" id="cb17-25" data-line-number="25">    <span class="st">&quot;1 not fully installed or removed.&quot;</span>,</a>
<a class="sourceLine" id="cb17-26" data-line-number="26">    <span class="st">&quot;After this operation, 0 B of additional disk space will be used.&quot;</span>,</a>
<a class="sourceLine" id="cb17-27" data-line-number="27">    <span class="st">&quot;Setting up jenkins (2.141) ...&quot;</span>,</a>
<a class="sourceLine" id="cb17-28" data-line-number="28">    <span class="st">&quot;Job for jenkins.service failed because the control process exited with error code.&quot;</span>,</a>
<a class="sourceLine" id="cb17-29" data-line-number="29">    <span class="st">&quot;See </span><span class="dt">\&quot;</span><span class="st">systemctl status jenkins.service</span><span class="dt">\&quot;</span><span class="st"> and </span><span class="dt">\&quot;</span><span class="st">journalctl -xe</span><span class="dt">\&quot;</span><span class="st"> for details.&quot;</span>,</a>
<a class="sourceLine" id="cb17-30" data-line-number="30">    <span class="st">&quot;invoke-rc.d: initscript jenkins, action </span><span class="dt">\&quot;</span><span class="st">start</span><span class="dt">\&quot;</span><span class="st"> failed.&quot;</span>,</a>
<a class="sourceLine" id="cb17-31" data-line-number="31">    <span class="st">&quot;\u001b[0;1;31m*\u001b[0m jenkins.service - LSB: Start Jenkins at boot time&quot;</span>,</a>
<a class="sourceLine" id="cb17-32" data-line-number="32">    <span class="st">&quot;   Loaded: loaded (/etc/init.d/jenkins; generated)&quot;</span>,</a>
<a class="sourceLine" id="cb17-33" data-line-number="33">    <span class="st">&quot;   Active: \u001b[0;1;31mfailed\u001b[0m (Result: exit-code) since Sun 2018-09-09 07:02:35 UTC; 6ms ago&quot;</span>,</a>
<a class="sourceLine" id="cb17-34" data-line-number="34">    <span class="st">&quot;     Docs: man:systemd-sysv-generator(8)&quot;</span>,</a>
<a class="sourceLine" id="cb17-35" data-line-number="35">    <span class="st">&quot;  Process: 27630 ExecStart=/etc/init.d/jenkins start \u001b[0;1;31m(code=exited, status=1/FAILURE)\u001b[0m&quot;</span>,</a>
<a class="sourceLine" id="cb17-36" data-line-number="36">    <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb17-37" data-line-number="37">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 systemd[1]: Starting LSB: Start Jenkins at boot time...&quot;</span>,</a>
<a class="sourceLine" id="cb17-38" data-line-number="38">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: Found an incorrect Java version&quot;</span>,</a>
<a class="sourceLine" id="cb17-39" data-line-number="39">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: Java version found:&quot;</span>,</a>
<a class="sourceLine" id="cb17-40" data-line-number="40">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: openjdk version </span><span class="dt">\&quot;</span><span class="st">10.0.2</span><span class="dt">\&quot;</span><span class="st"> 2018-07-17&quot;</span>,</a>
<a class="sourceLine" id="cb17-41" data-line-number="41">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: OpenJDK Runtime Environment (build 10.0.2+13-Ubuntu-1ubuntu0.18.04.1)&quot;</span>,</a>
<a class="sourceLine" id="cb17-42" data-line-number="42">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: OpenJDK 64-Bit Server VM (build 10.0.2+13-Ubuntu-1ubuntu0.18.04.1, mixed mode)&quot;</span>,</a>
<a class="sourceLine" id="cb17-43" data-line-number="43">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 jenkins[27630]: Aborting&quot;</span>,</a>
<a class="sourceLine" id="cb17-44" data-line-number="44">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 systemd[1]: \u001b[0;1;39m\u001b[0;1;31m\u001b[0;1;39mjenkins.service: Control process exited, code=exited status=1\u001b[0m&quot;</span>,</a>
<a class="sourceLine" id="cb17-45" data-line-number="45">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 systemd[1]: \u001b[0;1;39m\u001b[0;1;31m\u001b[0;1;39mjenkins.service: Failed with result &#39;exit-code&#39;.\u001b[0m&quot;</span>,</a>
<a class="sourceLine" id="cb17-46" data-line-number="46">    <span class="st">&quot;Sep 09 07:02:35 ip-172-31-18-219 systemd[1]: \u001b[0;1;31m\u001b[0;1;39m\u001b[0;1;31mFailed to start LSB: Start Jenkins at boot time.\u001b[0m&quot;</span>,</a>
<a class="sourceLine" id="cb17-47" data-line-number="47">    <span class="st">&quot;dpkg: error processing package jenkins (--configure):&quot;</span>,</a>
<a class="sourceLine" id="cb17-48" data-line-number="48">    <span class="st">&quot; installed jenkins package post-installation script subprocess returned error exit status 1&quot;</span>,</a>
<a class="sourceLine" id="cb17-49" data-line-number="49">    <span class="st">&quot;Errors were encountered while processing:&quot;</span>,</a>
<a class="sourceLine" id="cb17-50" data-line-number="50">    <span class="st">&quot; jenkins&quot;</span></a>
<a class="sourceLine" id="cb17-51" data-line-number="51"><span class="bu">]</span></a>
<a class="sourceLine" id="cb17-52" data-line-number="52"><span class="kw">}</span></a>
<a class="sourceLine" id="cb17-53" data-line-number="53"><span class="ex">to</span> retry, use: --limit @/home/ubuntu/interview-liatrio-2018/technical-exercise/ansible/playbook.retry</a></code></pre></div></li>
</ul>
<p>The output is more readable because I added “stdout_callback = minimal” to <code>ansible.cfg</code>. But essentially <code>geerlingguy.jenkins</code> depends on <code>geerlingguy.java</code>, which is installing openjdk v10. I <em>think</em> this version of <code>Jenkins</code> will only work with v8.</p>
<p>I’ll need to figure out how to write this into a playbook, but for now here’s the manual approach.</p>
<ul>
<li><p>[ ] <strong>TODO</strong> go back to 16.04?</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="ex">ubuntu@ip-172-31-29-171</span>:~/interview-liatrio-2018/technical-exercise/ansible$ sudo update-alternatives --config java</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ex">There</span> are 2 choices for the alternative java (providing /usr/bin/java)<span class="ex">.</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  <span class="ex">Selection</span>    Path                                            Priority   Status</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="ex">------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="ex">*</span> 0            /usr/lib/jvm/java-11-openjdk-amd64/bin/java      1101      auto mode</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">  <span class="ex">1</span>            /usr/lib/jvm/java-11-openjdk-amd64/bin/java      1101      manual mode</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">  <span class="ex">2</span>            /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java   1081      manual mode</a>
<a class="sourceLine" id="cb18-9" data-line-number="9"></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="ex">Press</span> <span class="op">&lt;</span>enter<span class="op">&gt;</span> to keep the current choice[*], or type selection number: 2</a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="ex">update-alternatives</span>: using /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java to provide /usr/bin/java (java) <span class="kw">in</span> <span class="ex">manual</span> mode</a></code></pre></div></li>
<li><p>check version</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="ex">ubuntu@ip-172-31-29-171</span>:~/interview-liatrio-2018/technical-exercise/ansible$ java -version</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="ex">openjdk</span> version <span class="st">&quot;1.8.0_181&quot;</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="ex">OpenJDK</span> Runtime Environment (build 1.8.0_181-8u181-b13-0ubuntu0.18.04.1-b13)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="ex">OpenJDK</span> 64-Bit Server VM (build 25.181-b13, mixed mode)</a></code></pre></div></li>
<li><p>finish jenkins install via apt</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="ex">ubuntu@ip-172-31-29-171</span>:~/interview-liatrio-2018/technical-exercise/ansible$ sudo apt install jenkins</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="ex">Reading</span> package lists... Done</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="ex">Building</span> dependency tree</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="ex">Reading</span> state information... Done</a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="ex">jenkins</span> is already the newest version (2.141)<span class="ex">.</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="ex">0</span> upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</a></code></pre></div></li>
<li><p>check systemctl</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="ex">ubuntu@ip-172-31-29-171</span>:~/interview-liatrio-2018/technical-exercise/ansible$ sudo systemctl status jenkins</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">● <span class="ex">jenkins.service</span> - LSB: Start Jenkins at boot time</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">   <span class="ex">Loaded</span>: loaded (/etc/init.d/jenkins<span class="kw">;</span> <span class="ex">generated</span>)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">   <span class="ex">Active</span>: active (exited) <span class="ex">since</span> Sun 2018-09-09 07:24:23 UTC<span class="kw">;</span> <span class="ex">1min</span> 11s ago</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">     <span class="ex">Docs</span>: man:systemd-sysv-generator(8)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">  <span class="ex">Process</span>: 32429 ExecStart=/etc/init.d/jenkins start (code=exited, status=0/SUCCESS)</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="ex">Sep</span> 09 07:24:22 ip-172-31-29-171 systemd[1]: Starting LSB: Start Jenkins at boot time...</a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="ex">Sep</span> 09 07:24:22 ip-172-31-29-171 jenkins[32429]: Correct java version found</a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="ex">Sep</span> 09 07:24:22 ip-172-31-29-171 jenkins[32429]:  * Starting Jenkins Automation Server jenkins</a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="ex">Sep</span> 09 07:24:22 ip-172-31-29-171 su[32477]: Successful su for jenkins by root</a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="ex">Sep</span> 09 07:24:22 ip-172-31-29-171 su[32477]: + ??? root:jenkins</a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="ex">Sep</span> 09 07:24:22 ip-172-31-29-171 su[32477]: pam_unix(su:session)<span class="bu">:</span> session opened for user jenkins by (uid=0)</a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="ex">Sep</span> 09 07:24:22 ip-172-31-29-171 su[32477]: pam_unix(su:session)<span class="bu">:</span> session closed for user jenkins</a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="ex">Sep</span> 09 07:24:23 ip-172-31-29-171 jenkins[32429]:    ...done.</a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="ex">Sep</span> 09 07:24:23 ip-172-31-29-171 systemd[1]: Started LSB: Start Jenkins at boot time.</a></code></pre></div></li>
</ul>
</body>
</html>
